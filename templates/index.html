<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>PM Internship Form</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        @keyframes fadeIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }
        .animate-fadeIn { animation: fadeIn 0.3s ease-out forwards; }
        
        /* Hide the default Google Translate widget */
        #google_translate_element { display: none !important; }
        .goog-te-banner-frame { display: none !important; }
        body { top: 0px !important; }
    </style>
</head>
<body class="min-h-screen bg-gray-100">

    <!-- Header -->
    <header class="bg-white shadow flex items-center justify-between px-4 sm:px-6 py-3 flex-wrap gap-4">
        <div class="flex items-center space-x-2">
            <h2 class="text-xl font-bold">PM Internship</h2>
        </div>
        <nav class="hidden md:flex space-x-4 font-semibold text-gray-700 flex-wrap justify-center">
            <a href="#">FAQs</a>
            <a href="#">Guidelines</a>
            <a href="#">Partner Companies</a>
            <a href="#">Manuals</a>
            <a href="#">Tutorials/Guidance Videos</a>
        </nav>
        <div class="flex items-center flex-wrap gap-2 justify-center">
             <!-- Language Selector Dropdown -->
            <div class="relative">
                <select id="language-selector" class="appearance-none bg-gray-100 border border-gray-300 text-gray-700 py-2 px-4 pr-8 rounded-lg leading-tight focus:outline-none focus:bg-white focus:border-blue-500 text-sm">
                    <option value="en">English</option>
                    <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
                    <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å (Telugu)</option>
                    <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç (Tamil)</option>
                    <option value="bn">‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ (Bengali)</option>
                    <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä (Marathi)</option>
                </select>
                 <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-gray-700">
                    <svg class="fill-current h-4 w-4" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20"><path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z"/></svg>
                </div>
            </div>
            <button class="bg-orange-200 px-3 py-1.5 text-sm sm:px-4 sm:py-2 sm:text-base rounded whitespace-nowrap">Apply Insurance</button>
            <button class="bg-orange-600 text-white px-3 py-1.5 text-sm sm:px-4 sm:py-2 sm:text-base rounded whitespace-nowrap">My Bharat Portal</button>
        </div>
    </header>

    <!-- Main Container -->
    <div class="flex lg:flex-row flex-col gap-4 sm:gap-6 p-4 sm:p-6">
        <!-- Left Panel -->
        <div class="bg-white border rounded-lg p-4 w-full lg:w-80">
            <img src="https://placehold.co/128x128/EFEFEF/333333?text=User" alt="Profile" class="rounded-full mx-auto mb-4 w-24 h-24 sm:w-32 sm:h-32" />
            <h3 class="text-center font-bold text-sm sm:text-base">Polavarapu Phani Durga Mani Srinivasa Rao</h3>
            <p class="text-center text-xs sm:text-sm">21 Yrs</p>
            <p class="text-center text-xs sm:text-sm">Profile Completed: <span class="font-semibold">50%</span></p>
            <p class="text-center mb-4 text-xs sm:text-sm">Konaseema, ANDHRA PRADESH</p>
            <a href="#" class="block bg-gray-100 text-center rounded py-2 mb-2 text-sm">View Profile / CV</a>
            <a href="#" class="block bg-gray-100 text-center rounded py-2 mb-2 text-sm">Change Password</a>
            <a href="#" class="block bg-gray-100 text-center rounded py-2 mb-2 text-sm">Sign Out</a>
            <div class="mt-6 border rounded p-4 bg-gray-50">
                <h4 class="font-semibold mb-2 text-sm">File a Grievance</h4>
                <button class="w-full bg-orange-500 opacity-80 text-white py-2 rounded text-sm">New Grievance</button>
                <p class="mt-3 text-xs">Grievance Status</p>
                <p class="text-xs">Pending: 0</p>
                <p class="text-xs">Disposed: 0</p>
            </div>
        </div>

        <!-- Center Panel -->
        <div class="bg-white border rounded-lg p-4 sm:p-6 flex-1">
            <div class="text-center mb-6 text-lg bg-orange-400 text-white font-bold py-3 px-6 rounded-lg shadow-md">Profile Registration</div>
            
            <form id="internshipForm" class="space-y-4">
                <div>
                    <label for="education" class="block font-semibold text-sm">Enter your Higher Education</label>
                    <input type="text" id="education" name="education" placeholder="e.g., B.Tech CSE, IIT Delhi" class="w-full border rounded px-3 py-2 text-sm" required />
                </div>
                <div>
                    <label class="block font-semibold text-sm">Name of Institute *</label>
                    <input type="text" id="institute" name="institute" class="w-full border rounded px-3 py-2 text-sm" />
                </div>
                <div>
                    <label class="block font-semibold text-sm">Interested Sector</label>
                    <select id="sector" name="sector" class="w-full border rounded px-3 py-2 text-sm" required>
                        <option value="">Select Sector</option>
                        <option value="Technology">Technology & AI</option>
                        <option value="Finance">Finance & Economy</option>
                        <option value="Healthcare">Healthcare & Biotech</option>
                    </select>
                </div>
                <div>
                    <label class="block font-semibold text-sm">Location</label>
                    <input type="text" id="location" name="location" class="w-full border rounded px-3 py-2 text-sm" />
                </div>
                <div>
                    <label class="block font-semibold text-sm">Skills (comma separated)</label>
                    <input type="text" id="skills" name="skills" placeholder="e.g., JavaScript, React, Python" class="w-full px-3 py-2 text-sm sm:px-5 sm:py-3.5 border border-gray-300 rounded-xl" required />
                </div>
                <div class="flex justify-center mt-6">
                    <button type="submit" id="findInternshipsBtn" class="bg-blue-700 text-white px-6 py-2.5 rounded-lg text-sm font-medium">Find Internships</button>
                </div>
            </form>
        </div>

        <!-- Right Panel -->
        <div class="bg-white border rounded-lg p-4 w-full lg:w-80">
             <h3 class="font-bold mb-4 text-sm">Notifications</h3>
             <div class="mb-4 space-y-1">
                 <h4 class="text-red-600 font-semibold text-[10px] sm:text-xs leading-tight">Action Required - How to Join after Accepting Your PM Inter...</h4>
                 <small class="text-gray-500 text-[10px]">June 2, 2025 at 14:45</small>
                 <p class="text-[10px] mt-1 leading-tight">How to Join, after you have accepted your offer letter: 1. ...</p>
             </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-200 text-center py-3 px-4 text-[10px] sm:text-xs">
        ¬© PM Internship Scheme, MCA. All Rights Reserved. | Technical collaboration with BISAG-N
    </footer>

    <!-- Modal (Initially Hidden) -->
    <div id="predModal" class="fixed inset-0 z-50 flex items-center justify-center p-2 sm:p-4 bg-black bg-opacity-60 backdrop-blur-sm hidden">
        <div class="relative w-full max-w-4xl sm:max-w-6xl min-h-[80vh] sm:min-h-[90vh] bg-white rounded-3xl shadow-2xl overflow-hidden transform transition-all duration-300 scale-100 animate-fadeIn">
            <div class="bg-gradient-to-r from-blue-600 to-indigo-600 px-4 sm:px-6 py-4 sm:py-5 flex justify-between items-center">
                <h2 class="text-lg sm:text-xl font-bold text-white">Your Matching Internships</h2>
                <button id="closeModalBtn" aria-label="Close modal">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 sm:h-6 sm:w-6 text-white hover:text-gray-200" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
            
            <!-- Scrollable Content Area -->
            <div class="p-4 sm:p-6 overflow-y-auto" style="max-height: calc(90vh - 130px);">
                <h1 class="text-xl sm:text-2xl font-extrabold text-gray-800 mb-2 sm:mb-3 text-center px-4">Matching Job Opportunities</h1>
                
                <!-- Container for Recommendation Cards -->
                <div id="modalContent" class="flex justify-center flex-wrap gap-4 sm:gap-6">
                    <!-- Content will be injected by JS -->
                </div>

                <!-- FAQ Section -->
                <div id="faqSection" class="mt-10 pt-6 border-t-2 border-gray-200">
                    <h3 class="text-lg font-bold text-center text-gray-800 mb-4">FAQ</h3>
                    <div class="space-y-4 text-sm text-left max-w-3xl mx-auto">
                        <div>
                            <h4 class="font-semibold text-gray-700">What does 'Overall Match' mean?</h4>
                            <p class="text-gray-600 mt-1">This is a weighted score based on how well your skills (60%) and education (30%) align with the internship's requirements. You get an extra 15% bonus if your preferred location matches.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">What do the Match Quality ratings mean?</h4>
                            <p class="text-gray-600 mt-1">These provide a quick summary of your match score. 'Excellent' (80%+) is a very strong fit, 'Good' (60%+) is a solid fit, and 'Fair' (40%+) may be worth considering.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">What does stipend and no-stipend mean ?</h4>
                            <p class="text-gray-600 mt-1">Stipend internship ‚Üí You will receive a fixed payment (could be monthly, weekly, or lump sum) for your work or participation. 
                            </p>
                            <p class="text-gray-600 mt-1">No-stipend internship ‚Üí You will not be paid. You may still gain experience, skills, or a certificate, but there‚Äôs no financial support.</p>
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">What is in-person and remote and hybrid interhips?</h4>
                            <p class="text-gray-600 mt-1">In-person ‚Üí Work fully at the company‚Äôs office
                            </p>
                            <p class="text-gray-600 mt-1">Remote ‚Üí Work fully online from home/anywhere.
                            </p>
                            <p class="text-gray-600 mt-1">Hybrid ‚Üí Combination of office work and remote work.
                            </p>
                            
                        </div>
                        <div>
                            <h4 class="font-semibold text-gray-700">How do I apply for these internships?</h4>
                            <p class="text-gray-600 mt-1">This tool helps you find matching opportunities. To apply, click the "Apply Now" button which should take you to the official 'My Bharat Portal' or the partner company's website where you can submit your formal application.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="px-4 sm:px-6 py-3 sm:py-4 bg-gray-50 border-t border-gray-200 text-center">
                <button id="closeModalBtn2" class="px-4 py-2 text-sm bg-indigo-600 text-white font-medium rounded-lg hover:bg-indigo-700">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Hidden div for the actual Google Translate widget -->
    <div id="google_translate_element"></div>

    <!-- Templates for JS -->
    <template id="skillBadgeTemplate">
        <span class="inline-block bg-blue-50 text-blue-700 text-[10px] font-medium mr-1 px-2 py-0.5 rounded-full border border-blue-200"></span>
    </template>
    <template id="jobCardTemplate">
        <div class="group w-full sm:w-[300px] flex flex-col bg-white border border-gray-100 rounded-2xl shadow-lg p-4 transform transition-all duration-300">
            <div class="flex justify-between items-start mb-3">
                <div>
                    <h2 class="text-base font-bold text-gray-800 group-hover:text-blue-600 job-role"></h2>
                    <p class="text-sm text-gray-600 font-medium company"></p>
                </div>
                <div class="bg-green-100 text-green-800 px-2 py-0.5 rounded-full text-[10px] font-semibold mode"></div>
            </div>
            <div class="bg-gradient-to-r from-green-400 to-teal-500 w-fit text-white font-bold text-sm px-3 py-1 rounded-full mb-3 shadow-md salary"></div>
            <div class="grid grid-cols-1 gap-2 mb-3 text-[10px] text-gray-700">
                <div><strong class="text-gray-500">üìç Location:</strong> <span class="location"></span></div>
                <div><strong class="text-gray-500">üéì Education:</strong> <span class="education"></span></div>
                <div><strong class="text-gray-500">üéì Duration:</strong> <span class="duration"></span></div>
                 <div class="mt-2"><strong class="text-gray-500">üéØ Match:</strong> <span class="font-bold text-blue-600 matching-percentage"></span></div>
            </div>
            <div class="match-quality-container mb-3"></div>
            <div class="mt-3">
                <p class="text-gray-500 text-[10px] font-medium mb-2">üîß Required Skills</p>
                <div class="flex flex-wrap gap-1 skills-container"></div>
            </div>
            <div class="mt-4">
                <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2.5 px-4 rounded-xl text-sm transition">Apply Now</button>
            </div>
        </div>
    </template>
    <template id="noResultsTemplate">
        <div class="text-center py-8 px-4">
            <div class="text-gray-400 text-4xl mb-3">üîç</div>
            <h3 class="text-lg font-medium text-gray-500">No matching jobs found</h3>
            <p class="text-gray-400 mt-2 text-sm">Try adjusting your skills or check back later.</p>
        </div>
    </template>

    <!-- Google Translate API Script -->
    <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <script>
        // --- START: Language and Form Logic ---

        // This is the official callback function that Google's script runs when it's ready.
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false
            }, 'google_translate_element');
            
            setupLanguageSelector();
        }

        // Attaches the event listener to our custom dropdown.
        function setupLanguageSelector() {
            const languageSelector = document.getElementById('language-selector');
            languageSelector.addEventListener('change', function() {
                triggerGoogleTranslation(this.value);
            });
        }
        
        // Programmatically changes the language using the "reset" method.
        function triggerGoogleTranslation(lang) {
            const googleTranslateElement = document.getElementById('google_translate_element');
            const googleTranslateSelect = googleTranslateElement.querySelector('.goog-te-combo');

            if (!googleTranslateSelect) {
                console.error("The Google Translate dropdown (.goog-te-combo) could not be found.");
                return;
            }

            googleTranslateSelect.value = 'en';
            googleTranslateSelect.dispatchEvent(new Event('change'));

            setTimeout(() => {
                if (lang !== 'en') {
                    googleTranslateSelect.value = lang;
                    googleTranslateSelect.dispatchEvent(new Event('change'));
                }
            }, 50);
        }
        
        // Sets up the recommendation form logic.
        document.addEventListener('DOMContentLoaded', () => {
            const internshipForm = document.getElementById('internshipForm');
            const findBtn = document.getElementById('findInternshipsBtn');
            const modal = document.getElementById('predModal');
            const modalContent = document.getElementById('modalContent');
            const closeBtns = document.querySelectorAll('#closeModalBtn, #closeModalBtn2');
            
            const jobCardTemplate = document.getElementById('jobCardTemplate').content;
            const skillBadgeTemplate = document.getElementById('skillBadgeTemplate').content;
            const noResultsTemplate = document.getElementById('noResultsTemplate').content;

            internshipForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                findBtn.textContent = 'Searching...';
                findBtn.disabled = true;

                const formData = new FormData(internshipForm);

                try {
                    const response = await fetch('/recommend', {
                        method: 'POST',
                        body: formData
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        alert(errorData.error || 'An error occurred.');
                        return;
                    }

                    const recommendations = await response.json();
                    displayRecommendations(recommendations);

                } catch (error) {
                    console.error('Error fetching recommendations:', error);
                    alert('Could not connect to the server.');
                } finally {
                    findBtn.textContent = 'Find Internships';
                    findBtn.disabled = false;
                    const currentLang = document.getElementById('language-selector').value;
                    if (currentLang !== 'en') {
                         triggerGoogleTranslation(currentLang);
                    }
                }
            });

            function displayRecommendations(recommendations) {
                modalContent.innerHTML = ''; // Clear previous content

                if (recommendations && recommendations.length > 0) {
                    recommendations.forEach(job => {
                        const card = document.importNode(jobCardTemplate, true);
                        card.querySelector('.job-role').textContent = job.title;
                        card.querySelector('.company').textContent = job.company;
                        card.querySelector('.mode').textContent = job.mode;
                        card.querySelector('.salary').textContent = job.salary?`stipend is : ${job.salary}`:"no-stipend";
                        card.querySelector('.location').textContent = job.location;
                        card.querySelector('.education').textContent = job.education;
                        card.querySelector('.duration').textContent = job.duration;
                        card.querySelector('.matching-percentage').textContent = `${job.matching_percentage}%`;

                        let matchQuality = 'Basic Match';
                        let matchColor = 'bg-gray-200 text-gray-800';
                        if (job.matching_percentage >= 80) {
                            matchQuality = 'Excellent Match';
                            matchColor = 'bg-green-100 text-green-800';
                        } else if (job.matching_percentage >= 60) {
                            matchQuality = 'Good Match';
                            matchColor = 'bg-blue-100 text-blue-800';
                        } else if (job.matching_percentage >= 40) {
                            matchQuality = 'Fair Match';
                            matchColor = 'bg-yellow-100 text-yellow-800';
                        }
                        
                        const matchQualityBadge = document.createElement('span');
                        matchQualityBadge.className = `px-3 py-1 text-xs font-semibold rounded-full ${matchColor}`;
                        matchQualityBadge.textContent = matchQuality;
                        
                        const badgeContainer = card.querySelector('.match-quality-container');
                        badgeContainer.appendChild(matchQualityBadge);

                        const skillsContainer = card.querySelector('.skills-container');
                        job.skills.forEach(skill => {
                            const badge = document.importNode(skillBadgeTemplate, true);
                            badge.querySelector('span').textContent = skill;
                            skillsContainer.appendChild(badge);
                        });

                        modalContent.appendChild(card);
                    });
                } else {
                    const noResults = document.importNode(noResultsTemplate, true);
                    modalContent.appendChild(noResults);
                }

                modal.classList.remove('hidden');
                
                const currentLang = document.getElementById('language-selector').value;
                if (currentLang !== 'en') {
                    triggerGoogleTranslation(currentLang);
                }
            }

            // Modal close logic
            closeBtns.forEach(btn => btn.addEventListener('click', () => modal.classList.add('hidden')));
            document.addEventListener('keydown', (e) => {
                if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                    modal.classList.add('hidden');
                }
            });
        });
        // --- END: Language and Form Logic ---
    </script>
</body>
</html>

